# 二叉树



### 0x00 二叉树上的基本操作



**Definition** 对于树上的每个结点，它的左子树都是都小于等于它，它的右子树都大于等于它，则称该树为二叉树。 

**对于树上结点的概述** 每个结点$d$至少包含4个属性，关键字$d.key$，左子树指针$d.left$，右子树指针$d.right$，和双亲指针$d.p$. 



树上的基本操作包括

1. **Search** 查找某个具体的结点;
2. **Minimum** 查找最小元素;
3. **Maximum** 查找最大的元素;
4. **Search-next** 查找后继，所谓后继就是将二叉树上的结点按从小到大线性排列之后，紧挨着当前元素的后一个元素;
5. **Search-prev** 查找前驱，即线性排序上，紧挨着当且元素的前一个元素;
6. **Insert** 插入某个元素;
7. **Delete** 删除某个树上的结点. 



**关于Search-next的特殊说明** 

对于一个结点$d$的后继，那肯定要比它大，比它大的点位于

1. 它的右子树$d.right$;
2. 若它位于某个结点$z.left$的左子树，那么$z$和$z.right$都是比它大的点

再接着考虑比它的大的，但是最小的那个. 

1. 显然情况1中的结点要小于情况2中的结点，因为$d$是$z$左子树中的结点，那么以$d$为结点的子树也应该在$z$的左子树中. 即优先考虑$d$的右子树中最小的那个结点。

2. 在情况2的条件下，最贴近$d$应该是从$d$往上搜，第一个满足情况2的$z$结点. 



**关于Delete的特殊说明**

从二叉树删除一个结点$d$，有下面三种情况:

1. 如果$d$没有孩子结点，那么直接将其删除即可，同时更新它父节点对应的孩子信息; 
2. 如果$d$只有一个孩子结点，那么直接将$y$替换为这个孩子结点即可，同时更新孩子结点父节点信息和对应$y$的父节点的孩子信息;
3. 如果$d$有两个孩子结点，那么考虑用右子树中最小的元素结点$z$来替换$y$ (同样也可以用左子树中最大的元素). 所以需要先删除$z$，可以确保它最多只有一个右孩子，这里的删除可以遵循第2步;  用$z$替换$y$，需要更新$z$的孩子结点信息和父节点信息， 同时更新$y$的父节点的孩子信息. 







### 0x00 红黑树

一颗红黑树是满足下面==红黑性质==的二叉搜索树

1. 每个结点或是红色，或是黑色的;
2. 根结点是黑色的;
3. 每个叶子结点(NIL)是黑色的;
4. 如果一个结点是红色的，则它的两个子结点都是黑色的;
5. 对于每一个结点，该结点到其所有后代叶子结点的简单路径上，均包含相同数目的黑色结点。

注意红黑树是一颗==满二叉树==，所有剩余的孩子结点都会用NIL填充。



**Definition** 从红黑树上的某个结点$x$出发到达一个叶节点的任意一条简单路径上的黑色结点个数称为==黑高==，用$bh(x)$表示。

**Lemma** 红黑树上任意一个结点以$x$为根结点的子树中至少包含$2^{bh(x)}-1$个内部结点，其中$bh(x)$表示$x$的黑高。

*Proof.* 归纳

**Theorem** 一棵有$n$个内部结点的红黑树的高度最高为$2\lg(n+1)$. 

*Proof*. 这里直接前面的Lemma来证明， 在红黑树的第4条性质的保证下，若树高为$h$，则根的黑高最少为$\frac{h}{2}$，即每层红黑交替.  根据前面的Lemma这里有$n \geq 2^{\frac{h}{2}}-1 \Rightarrow  h \leq 2 \lg (n+1)$.   

 

**Definition** 两个不改变二叉树性质的选择操作:

1. ==右旋==   若结点$y$的左孩子$x$存在，将$y$所在的位置替换为$x$，同时将$x$的右子树放到$y$的左孩子上，此时$x$的右孩子为$y$.  
2. ==左选==   若结点$x$的右孩子$y$存在，将$x$所在的位置替换为$y$，同时将$y$的左子树放到$x$的右孩子上，此时$y$的左孩子为$x$. 





![image-20210906225810149](/home/maple/halfyear/images/image-20210906225810149.png)

==所谓左右==，对某个结点做旋转时，是将这个结点往左下走，还是往右下走.



**关于红黑树数的Insert操作**

红黑树的插入操作分为两步:

1. 对一个二叉树正常执行插入操作;
2. 对插入的结点标红，执行fixed操作，保证这一次插入不破坏红黑树的性质。



为什么会破坏红黑树的性质？

1. 二叉树插入的结点最初都在叶子结点上;
2. 这个叶子结点可能是根结点，那么初始化的红色肯定要变成黑的;
3. 这个叶子结点的父结点也是红色的，那么这里需要解决这种冲突.



对于上述情况3的解决总体要把握，在需要保证红黑树第5条性质的基础上，即不要单方面新增黑色结点(这要需要考虑第5条性质不可能被破坏)来解决冲突，设插入结点为$z$，且$z.\color == red ~~\text{and} ~~ z.p.color == red$.   那么解决冲突的手法思路: 

1.  这里我们肯定一个事实就是$z.p.p.color = black$ ，即$z$的爷爷结点肯定是黑色的.

   ![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIgAAACFCAYAAACAJLCMAAAAAXNSR0IArs4c6QAABMF0RVh0bXhmaWxlACUzQ214ZmlsZSUyMGhvc3QlM0QlMjJ3d3cuaW9kcmF3LmNvbSUyMiUyMG1vZGlmaWVkJTNEJTIyMjAyMS0wOS0wNlQxNSUzQTM2JTNBMzAuMTIzWiUyMiUyMGFnZW50JTNEJTIyNS4wJTIwKFgxMSUzQiUyMExpbnV4JTIweDg2XzY0KSUyMEFwcGxlV2ViS2l0JTJGNTM3LjM2JTIwKEtIVE1MJTJDJTIwbGlrZSUyMEdlY2tvKSUyMENocm9tZSUyRjkyLjAuNDUxNS4xNTklMjBTYWZhcmklMkY1MzcuMzYlMjIlMjBldGFnJTNEJTIycG9qMVd6UjhfVExYS3Z5Y3AwVVUlMjIlMjB2ZXJzaW9uJTNEJTIyMTMuMy42JTIyJTIwdHlwZSUzRCUyMmRldmljZSUyMiUzRSUzQ2RpYWdyYW0lMjBpZCUzRCUyMlJuVks0MDZrdVZISjM3cHR0VDdaJTIyJTIwbmFtZSUzRCUyMiVFNyVBQyVBQyUyMDElMjAlRTklQTElQjUlMjIlM0U3WlpSYjVzd0VNYyUyRkRZJTJCVEFFTkRIOWMwWFZXMTBxUm9XJTJGTTB1WEFCYndZanh5bWtuMzRIdGdPR2R1M1VUZFcwaFlmNGZ2WWQ1JTJGOGRCbzhzeSUyRmFEcEhWeEl6TGdYdWhuclVmT3ZUQU1naVRHdjQ0Y05EbUpETWdseXpUeUI3Qm1EMkE4TGQyekRIYUdhYVNFNElyVkxreEZWVUdxSEVhbEZJMjdiQ3Q0NW9DYTVqQUQ2NVR5T2YzQ01sVm9tc1QlMkJ3QyUyQkI1WVc5YyUyQkNibVpMYXhRYnNDcHFKWm9USXlpTkxLWVRTbzdKZEF1JTJGRWMzVzVlR0wybUppRVNyM0VZWEg5N1lyZWZMcUdyNWVWdU5vazR2TnElMkY4NUV1YWQ4Ynpac2tsVUhxd0JHUWJIUk9Hc0twbUJkMDdTYmFiRGV5QXBWY3JRQ0hOSmRyU3V3WlMzZ1RjOXlTVE9HMlMwRkY3SVBSdTc2QyUyQmUyalBNUjM4YmRoWHlucFBnT281bVQlMkZvY3pKbE9RQ3RvbkpRaU93bUpIZ2loQnlRTXVNUTdr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)

2. 那我们考虑将$z.p.p$的黑色下放，放到$z.p$上，那么对应的也要考虑$z.p.p.right$. 